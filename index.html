<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mark's Onbrand Stuff</title>
    <link rel="stylesheet" href="./scss/styles.scss">
</head>

<body>
    <section class="section">
        <div class="container">
            <h1 class="title">Mark's Onbrand Projects</h1>
            <h2 class="subtitle">
                Hopefully everything you might need to know or find about the stuff I've built.
            </h2>
            <section class="columns">
                <aside class=" column menu">
                    <p class="menu-label">
                        Project Resources
                    </p>
                    <ul class="menu-list">
                        <li>
                            <a class="inPageLink" data-for="repositories">Repositories</a>
                        </li>
                        <li>
                            <a class="inPageLink" data-for="npmPage">NPM</a>
                        </li>
                        <li>
                            <a class="inPageLink" data-for="docs">Documentation</a>
                        </li>
                    </ul>
                    <p class="menu-label">
                        How To's
                    </p>
                    <ul class="menu-list">
                        <li>
                            <a>Set up a new onbrand project</a>
                        </li>
                        <li>
                            <a>Update a framework template</a>
                        </li>
                        <li>
                            <a>Update Utility Functions</a>
                        </li>
                    </ul>
                </aside>
                <main class="column">
                    <article id="repositories" class="content cardsList">
                        <ul>
                            <li class="card">
                                <div class="card-content">
                                    <h4 class="title is-4">Onbrand Asset Obtainer</h4>
                                    <p class="content">
                                        The repository for the program typically run via the "steal" command. Used to grab all styles from a particular website,
                                        and save them in the appropriate order in your client.scss. It also attempts to prevent
                                        conflits by namespacing.
                                    </p>
                                    <a href="https://github.com/mwilkins91/onbrand-assetObtainer" class="block">Github</a>
                                </div>
                            </li>
                            <li class="card">
                                <div class="card-content">
                                    <h4 class="title is-4">Onbrand Utility Functions</h4>
                                    <p class="content">
                                        The repository for the library which houses various reusable fuctions that make Onbranding a hub much easier, and eliminates
                                        various bugs. Also contains various SCSS functions.
                                    </p>
                                    <a href="https://github.com/mwilkins91/onbrand-utilityfunctions" class="block">Github</a>
                                </div>
                            </li>
                            <li class="card">
                                <div class="card-content">
                                    <h4 class="title is-4">Onbrand Local Development Frameworks</h4>
                                    <p class="content">
                                        The two branches of this repository contain two different frameworks for developing hubs on a local machine. The master branch
                                        is a gulp powered version, and the webpack branch is a webpack powered version. The
                                        webpack version is the more user-friendly and stable of the two. The webpack version
                                        makes extensive use of the
                                        <a href="https://github.com/mwilkins91/onbrand-utilityfunctions">Onbrand Utility Functions</a> Library.
                                    </p>
                                    <a href="https://github.com/mwilkins91/onbrand-localDev" class="block">Gulp: Github</a>
                                    <a href="https://github.com/mwilkins91/onbrand-localDev/tree/webpack" class="block">Webpack: Github</a>
                                    <a href="https://github.com/mwilkins91/onbrandTemplate-Nick" class="block">Original (Nick Roamer): Github</a>
                                </div>
                            </li>
                            <li class="card">
                                <div class="card-content">
                                    <h4 class="title is-4">Onbrand Project Generator</h4>
                                    <p class="content">
                                        This is the repository for the program which runs on cihost when you use the command "generate". It builds projects based
                                        on what is in it's "templates" folder, which is typically the frameworks found in
                                        the
                                        <a href="https://github.com/mwilkins91/onbrand-generator">local development frameworks</a>.
                                    </p>
                                    <a href="https://github.com/mwilkins91/onbrand-generator" class="block">Github</a>
                                </div>
                            </li>
                            <li class="card">
                                <div class="card-content">
                                    <h4 class="title is-4">Onbrand Slack Bot</h4>
                                    <p class="content">
                                        This is the repository for the onbrand Slackbot, which announces the fire marshal every morning, and it's associated website.
                                        The repo is set to private to protect the api-keys.
                                    </p>
                                    <a href="https://github.com/mwilkins91/onbrand-firemarshal" class="block">Github</a>
                                    <a href="http://cihost.uberflip.com/fire/" class="block">Scheduling Website</a>
                                </div>
                            </li>
                        </ul>
                    </article>
                    <article id="npmPage" style="display:none;" class="content cardsList">
                        <ul>
                            <li class="card">
                                <div class="card-content">
                                    <h4 class="title is-4">Onbrand Asset Obtainer</h4>
                                    <p class="content">
                                        The repository for the program typically run via the "steal" command. Used to grab all styles from a particular website,
                                        and save them in the appropriate order in your client.scss. It also attempts to prevent
                                        conflits by namespacing.
                                    </p>
                                    <a href="https://www.npmjs.com/package/onbrand-steal" class="block">NPM</a>
                                </div>
                            </li>
                            <li class="card">
                                <div class="card-content">
                                    <h4 class="title is-4">Onbrand Utility Functions</h4>
                                    <p class="content">
                                        The repository for the library which houses various reusable fuctions that make Onbranding a hub much easier, and eliminates
                                        various bugs. Also contains various SCSS functions.
                                    </p>
                                    <a href="https://www.npmjs.com/package/onbrandutilityfunctions" class="block">NPM</a>
                                </div>
                            </li>
                            <li class="card">
                                <div class="card-content">
                                    <h4 class="title is-4">Onbrand Project Generator</h4>
                                    <p class="content">
                                        This is the repository for the program which runs on cihost when you use the command "generate". It builds projects based
                                        on what is in it's "templates" folder, which is typically the frameworks found in
                                        the
                                        <a href="https://github.com/mwilkins91/onbrand-generator">local development frameworks</a>.
                                    </p>
                                    <a href="https://www.npmjs.com/package/onbrand-project-generator" class="block">NPM</a>
                                </div>
                            </li>
                        </ul>
                    </article>
                    <article id="docs" style="display:none;" class="content cardsList">
                        <ul>
                            <li class="card">
                                <div class="card-content">
                                    <h4 class="title is-4">Onbrand Asset Obtainer</h4>
                                    <p class="content">
                                        The repository for the program typically run via the "steal" command. Used to grab all styles from a particular website,
                                        and save them in the appropriate order in your client.scss. It also attempts to prevent
                                        conflits by namespacing.
                                    </p>
                                    <p class="title is-5">How it works:</p>
                                    <p class="title is-6">The main initialization function:</p>
                                    <pre><code class="language-javascript">
async function init() {
    let confirmation = await checkLocation().catch(err =>
        logError(err, 'checkLocation')
    );
    if (confirmation) {
        const progressBar = new cliProgress.Bar(
            {},
            cliProgress.Presets.shades_classic
        );
        let url = await getinfo().catch(err => logError(err, 'getInfo'));
        progressBar.start(100, 0);
        progressBar.update(10);
        let assets = await launchBrowser(url).catch(err =>
            logError(err, 'launchBrowser')
        );
        progressBar.update(35);
        let clientCss = await getCSS(assets.stylesheet).catch(err =>
            logError(err, 'getCss')
        );
        progressBar.update(75);
        let bundledCss = bundleCss(clientCss, assets.inlineStyles);
        progressBar.update(85);
        printCss(bundledCss, progressBar);
    }
}
                                    </code></pre>
                                    <p>Can be broken down as follows:</p>
                                    <ol>
                                        <li>
                                            <p>A user enter's
                                                <code>generate</code> in thier terminal.</p>
                                        </li>
                                        <li>
                                            <p>A check is done to ensure we are in an onbrand folder. We are.
                                                <a href="https://www.npmjs.com/package/inquirer">
                                                    <code>Inquirer</code>
                                                </a> is used to prompt the user for confirmation of their intent (to overwrite
                                                their client.scss). User confirms.</p>
                                            <pre><code class="language-javascript">
let confirmation = await checkLocation().catch(err =>
    logError(err, 'checkLocation')
);
                                                            </code></pre>
                                        </li>
                                        <li>
                                            <p>
                                                <a href="https://www.npmjs.com/package/inquirer">
                                                    <code>Inquirer</code>
                                                </a> is used to prompt the user for a URL.
                                            </p>
                                            <pre><code class="language-javascript">
let url = await getinfo().catch(err => logError(err, 'getInfo'));
                                                </code></pre>
                                        </li>
                                        <li>
                                            <p>
                                                <a href="https://www.npmjs.com/package/puppeteer">
                                                    <code>Pupetteer</code>
                                                </a> initiates, and navigates to the URL provided. A record is kept of all external
                                                requests made by the webpage.
                                                <a href="https://www.npmjs.com/package/puppeteer">
                                                    <code>Pupetteer</code>
                                                </a> also executes JS on the page to grab all inline styles from the page.</p>
                                            <pre><code class="language-javascript">
let assets = await launchBrowser(url).catch(err =>
    logError(err, 'launchBrowser')
);
                                                 </code></pre>
                                        </li>
                                        <li>
                                            <p>All style sheets are then requested by us, and concatinated together in the appropriate
                                                order.
                                            </p>
                                            <pre><code class="language-javascript">
let clientCss = await getCSS(assets.stylesheet).catch(err =>
    logError(err, 'getCss')
);
let bundledCss = bundleCss(clientCss, assets.inlineStyles);
                                               </code></pre>
                                        </li>
                                        <li>
                                            <p>We use Node's file system module to write the file to disk.</p>
                                            <pre><code class="language-javascript">
printCss(bundledCss, progressBar);
                                                                                                   </code></pre>
                                        </li>
                                    </ol>
                                </div>
                            </li>
                            <li class="card">
                                <div class="card-content">
                                    <h4 class="title is-4">Onbrand Utility Functions</h4>
                                    <p class="content">
                                        The repository for the library which houses various reusable fuctions that make Onbranding a hub much easier, and eliminates
                                        various bugs. Also contains various SCSS functions.
                                    </p>
                                    <a href="http://cihost.uberflip.com/docs/" class="block">Auto-generated Documentation</a>
                                    <p class="title is-5">A Short list of available functions, with descriptions and use-cases:</p>
                                    <ul>
                                        <li>
                                            <p>
                                                <a href="http://cihost.uberflip.com/docs/#getstreamclass">getStreamClass</a> simply returns the current page's stream class, or false
                                                if it doesn't have one.</p>
                                            <pre><code class="language-javascript">
const stream = getStreamClass();
console.log(stream) // 'stream-xxxxxx' or false
                                                                                                        </code></pre>
                                        </li>
                                        <li>
                                            <p>
                                                <a href="http://cihost.uberflip.com/docs/#recoenginepositioning">recoEnginePositioning</a> will stick make the reco engine sticky to whatever
                                                selector you supply this function. This prevents the diffult "glitchy" behaviour,
                                                which leaves a gap on scroll, and helps make the injected-header look more
                                                natural.
                                            </p>
                                            <pre><code class="language-javascript">
Hubs.Events.on('scroll', function(){
    recoEnginePositioning('.top-nav'); // keep the reco engine with the top-nav 
})                                     // until it hits the top of the page.
                                                                                                            </code></pre>
                                        </li>
                                        <li>
                                            <p>
                                                <a href="http://cihost.uberflip.com/docs/#doiftag" class="bold">doIfTag</a>
                                                &
                                                <a href="http://cihost.uberflip.com/docs/#doiftagregex" class="bold">doIfTagRegex</a> are functions to apply logic based on the pressence of a
                                                tag on a tile. It is possible these two functions could be combined into
                                                one smarter function. They each take a "tag" as the first argument, as either
                                                a string or a regular expression. the second and thrid arguments are functions
                                                you supply to execute if the tag was preasent or not. EX:
                                            </p>
                                            <pre><code class="language-javascript">
doIfTag('tagName', function(){
    // turn the label of all tiles tagged with "tagName" to "I'm tagged!"
    $(this).find('a.view').text('I\'m tagged!');
}, function(){
    //remove all tiles that do not have the tag "tagName"
    $(this).remove();
})
                                                    </code></pre>
                                            <p>Additionally, if you need to ensure that your code is not run more than once
                                                per tile (maybe you're calling it on loadAdditionalItems?) you can provide
                                                an additional argument, which is a string representing a class to exclude
                                                from the loop. EX:
                                            </p>
                                            <pre><code class="language-javascript">
doIfTag('tagName', function(){
    // turn the label of all tiles tagged with "tagName" to "I'm tagged!"
    $(this).find('a.view').text('I\'m tagged!');

    // we add 'someClassName' so that this function
    // won't fire on this tile again.
    $(this).addClass('someClassName');
}, function(){
    //remove all tiles that do not have the tag "tagName"
    $(this).remove();

    // we add 'someClassName' so that this function
    // won't fire on this tile again.
    $(this).addClass('someClassName');
}, 'someClassName') // we pass 'someClassName' as the last 
                    // argument, telling doIfTag not to run on 
                    // any tile with this class.
                                             </code></pre>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                            <li class="card">
                                <div class="card-content">
                                    <h4 class="title is-4">The Webpack Framework</h4>
                                    <p class="content">
                                        The local development framework which uses webpack for its build process, as well as browsersync for its hub-proxy.
                                    </p>
                                    <p class="title is-5">Getting the hub local:</p>
                                    <p class="is-6">Getting the hub proxied onto a local machine was easy, but getting it to work right was
                                        tricky. Here is a brief explaination of how it works.
                                    </p>
                                    <ul>
                                        <li>
                                            <p>
                                                <span class="bold">The development server:</span> The server is actually a webpack server, proxying
                                                the hub, and a browsersync server proxying the webpack server. This is done
                                                to get the best of both worlds. Webpack is substantially faster at building
                                                when running a server, as it will store and serve assets from memory rather
                                                than the harddrive. Browsersync makes it easy to auto-reload/inject changed
                                                styles, and to serve your local content to other devices on the same network.
                                                This lets us show coachs our work, or test on mobile devices.</p>
                                            <pre><code class="language-javascript">
function browserSyncInit() {
    browserSync({
        proxy: {
            target: devOptions.fullHubUrl
        },
        serveStatic: ['.'],
        files: [
            './build/**/*.js',
            './build/**/*.css',
            './build/**/*.map',
            './includes/**/*.html'
        ]
    });
    browserSyncOn = true;
}
                                                     </code></pre>
                                        </li>
                                        <li>
                                            <p>
                                                <span class="bold">Page Changes:</span> The hub is a single page application, which means it
                                                does not actually change pages when you click a link. Instead, it manipulates
                                                browser history and the content of the page with javascript. When proxied,
                                                none of this works.
                                            </p>
                                            <p>To get our local environment, the
                                                <a href="http://cihost.uberflip.com/docs/#_relativelinks">_relativelinks</a> and
                                                <a href="http://cihost.uberflip.com/docs/#_internallink">_internallink</a> are used. These functions deconstruct all links on every
                                                page of a locally hosted hub, and remove all the javascript accociated with
                                                them. They then add in javascript to change the page on click, and manually
                                                trigger the on page change event. This means for an outside observer, the
                                                hub appears to work almost exactly the same as a live hub, but really it
                                                is performing a full page load instead of ajaxing in the new page. Importantly
                                                however, the code you write for pageChanges behaves as it would in live,
                                                allowing us to develop normally.</p>
                                        </li>
                                        <li>
                                            <p>
                                                <span class="bold">The Snippets:</span> Getting the hub to load in local assets 
                                                is as simple as using a relative path on the links you add to the backed of the hub.
                                                Changing the links back and forth to switch from local to production was a big hassle though,
                                                so using some simple conditionals and a query string, we teach the hub how to tell where
                                                to look for it's onbrand files:
                                            </p>
                                            <pre><code class="language-html">
&lt;style&gt;
/** =-=-= DEVELOPMENT =-=-= **/
/** 
    *  onBrand CSS &ndash; WARNING: Do not remove code block below.
    */
&lt;/style&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css&quot;&gt;
&lt;script&gt;
        var url = window.location.href;
    window.hasOnbrand = false;

    if (url.indexOf('?onbrand') != -1) {
        window.hasOnbrand = true;
    } else if (url.indexOf('&amp;onbrand') != -1) {
        window.hasOnbrand = true;
    } else {
        window.hasOnbrand = false;
    }
&lt;/script&gt;
&lt;script id=&quot;onbrand__styles--script&quot;&gt;//&lt;![CDATA[
    if(window.hasOnbrand){
            document.write(&quot;&lt;link id=\&quot;onbrand__styles\&quot; rel=\&quot;stylesheet\&quot; href=\&quot;\/build/style.css\&quot;&gt;&quot;);
    } else {
        document.write(&quot;&lt;link id=\&quot;onbrand__styles\&quot; rel=\&quot;stylesheet\&quot; href=\&quot;\/\/cihost.uberflip.com/${cihostFolder}/build/style.css\&quot;&gt;&quot;);
    }
//]]&gt;&lt;/script&gt;
&lt;style&gt;
/* Add your CSS rules below */
&lt;/style&gt;
                                            </code></pre>
                                            <p>The above code snippet is in the head of the document, ensuring that
                                                we can check at any point of the document which file we should load.
                                                Then, we simply either load a asset from cihost, or one from our local
                                                machine (relative path).
                                            </p>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                            <li class="card">
                                <div class="card-content">
                                    <h4 class="title is-4">Onbrand Project Generator</h4>
                                    <p class="content">
                                        This is the repository for the program which runs on cihost when you use the command "generate". It builds projects based
                                        on what is in it's "templates" folder, which is typically the frameworks found in
                                        the
                                        <a href="https://github.com/mwilkins91/onbrand-generator">local development frameworks</a>.
                                    </p>
                                    <a href="https://github.com/mwilkins91/onbrand-generator" class="block">Documentation</a>
                                </div>
                            </li>
                            <li class="card">
                                <div class="card-content">
                                    <h4 class="title is-4">Onbrand Slack Bot</h4>
                                    <p class="content">
                                        This is the repository for the onbrand Slackbot, which announces the fire marshal every morning, and it's associated website.
                                        The repo is set to private to protect the api-keys.
                                    </p>
                                    <a href="https://github.com/mwilkins91/onbrand-firemarshal" class="block">Documentation</a>
                                    <a href="http://cihost.uberflip.com/fire/" class="block">Scheduling Website</a>
                                </div>
                            </li>
                        </ul>
                    </article>
                </main>
            </section>
        </div>
    </section>

    <script src="./index.js"></script>
</body>

</html>